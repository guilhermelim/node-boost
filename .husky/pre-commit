#!/bin/sh

# Define arquivos staged (prontos para commit)
# .husky/pre-commit
stagedFiles=$(git diff --cached --name-only --diff-filter=ACMR | sed 's| |\\ |g')

# Define arquivos editados (nÃ£o necessariamente staged)
changedFiles=$(git diff --name-only --diff-filter=ACMR | sed 's| |\\ |g')

# FunÃ§Ã£o para aplicar Prettier e ESLint em arquivos
run_tools() {
  files=$1
  if [ -n "$files" ]; then
    echo "ğŸ› ï¸ Aplicando Prettier..."
    prettier $files --write --ignore-unknown

    echo "ğŸ” Aplicando ESLint..."
    # eslint $files --fix

    echo "âœ… Atualizando Ã­ndices do Git..."
    git update-index --again

    # Verifica o status dos testes
    if [ $? -ne 0 ]; then
      echo "âŒ Testes falharam. Abortando o commit."
      exit 1
    fi
  else
    echo "âš ï¸ Nenhum arquivo encontrado para processar."
  fi
}

# echo "ğŸ”„ Processando todos os arquivos modificados..."
# run_tools "$changedFiles"

echo "ğŸ”„ Processando arquivos staged..."
run_tools "$stagedFiles"
